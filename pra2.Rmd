---
title: "PRA2-Tipologia"
author: "David Lucas, Javier Cantero"
date: "25/5/2022"
output: 
  pdf_document:
    number_sections: yes
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo=FALSE}
# PAQUETES
if (!require('nortest')) install.packages('nortest'); library('nortest')
```

# Descripción del dataset  

Para llevar a cabo el desarrollo de esta práctica, se utilizará el dataset obtenido en la Práctica 1. Este dataset contiene datos de cada uno de los jugadores que hayan interactuado con la NBA durante un periodo de tiempo específico (última temporada) y recoge todas las estadísticas acumuladas. Adicionalmente, el dataset incluye la variable PER1 (player efficiency rating) que permite evaluar la eficiencia del jugador con respecto a las estadísticas totales de la temporada. Mediante esta variable, se podrá conocer cómo ha sido el rendimiento del jugador y poder comparar con el resto de jugadores de una manera rápida y sencilla. 

Es imporante porque demuestra que los resultados de un jugador se pueden llegar a evaluar a partir de métricas y se pueden realizar predicciones de los resultados que continuará obteniendo.

Pretende ser capaz de facilitar las predicciones de MVPs de la temporada a través de los datos de los jugadores.



# Integración y selección de los datos de interés a analizar

Lo primero que se hará es abrir el dataset.  

```{r}

playerstats <- read.csv("NBAPlayerStatistics_20-21.csv", stringsAsFactors = FALSE)

head(playerstats)

```

Vemos los 6 primeros valores del dataset, donde ya se aprecia que para el jugador Aaron Gordon existen 2 registros. Esto es debido a que ha jugado en 2 equipos distintos a lo largo de la temporada y se guardan sus estadísticas por separado.  

En esta colección de datos de los jugadores, sólo podemos encontrar estadísticas de los partidos, pero también sería interesante conocer su edad y su posición. Para incluir esta información, utilizaremos un dataset público de kaggle: https://www.kaggle.com/datasets/umutalpaydn/nba-20202021-season-player-stats?resource=download

```{r}

playerstats2 <- read.csv("nba2021_advanced.csv", stringsAsFactors = FALSE)

summary(playerstats2)

```

En este dataset podemos encontrar la posición y la edad a través de su nombre. A continuación, obtendremos esta información y la incluiremos en el dataset original.  

```{r}

# playerstats["Age"] <- playerstats2$Age[playerstats2$Player == playerstats$Nombre]
playerstats["Age"] <- NULL
playerstats["Pos"] <- NULL

for (i in 1:length(playerstats$Nombre)){
  for (j in 1:length(playerstats2$Player))
    if(playerstats$Nombre[i] == playerstats2$Player[j]){
      playerstats$Age[i] <- playerstats2$Age[j]
      playerstats$Pos[i] <- playerstats2$Pos[j]
    }
}

playerstats <- playerstats[,c(1,2,20,21,3:19)]

```

Ya tenemos el dataset final con la información de la edad y posición de cada jugador además de las estadísticas de partidos. Veremos si se han quedado jugadores sin esta información:  

```{r}

sum(is.na(playerstats["Age"]))
sum(is.na(playerstats["Pos"]))
```

Vemos que todos los jugadores tienen adjudicada su edad y su posición, así que volveremos a ver un resumen de los datos.

```{r}
summary(playerstats)
```


Teniendo la edad se puede extraer información útil respecto a su rendimiento, pudiendo conocer si la edad está relacionada en bajar sus estadísticas. También podremos tener en cuenta la posición a la hora de evaluarlas, pues no todas las posiciones tienen las mismas funciones en el partido.  

Una vez tenemos todos los datos, nos quedaremos únicamente con los que necesarios. Tanto para los tiros de 2 y 3 puntos como para los tiros libres tenemos un par de variables: los aciertos y los intentos. Esta información la podemos reducir al porcentaje de aciertos de modo que se simplifique el dataset.  


```{r}

playerstats["FG2%"] <- round((playerstats["FG"] - playerstats["FG3"]) / (playerstats["FGA"] - playerstats["FG3A"]), 2)

playerstats["FG3%"] <- round(playerstats["FG3"] / playerstats["FG3A"], 2)

playerstats["FT%"] <- round(playerstats["FT"] / playerstats["FTA"], 2)

```

Ahora nos quedaremos con las nuevas variables y el resto de variables útiles.  

```{r}

playerstats <- playerstats[,c(1:5,22:24,12:21)]

```

# Limpieza de los datos
## Ceros y elementos vacíos
```{r}

colSums(is.na(playerstats))

```

Vemos que para las variables de porcentajes de tiros existen algunos registros con valores NaN.

```{r}

colSums(playerstats==""|playerstats==" ")

```

En cambio, no existen valores vacíos.

Para tratar los NaN, no podemos eliminar los registros. Es por esto que el tratamiento que se le dará será colocar un 0.  

```{r}

playerstats$`FG2%`[is.na(playerstats$`FG2%`)] <- 0.00

playerstats$`FG3%`[is.na(playerstats$`FG3%`)] <- 0.00

playerstats$`FT%`[is.na(playerstats$`FT%`)] <- 0.00


# Comprobación de que ya no hay valores NaN 
colSums(is.na(playerstats))

```

## Identificación y gestión de valores extremos
Para los outliers, 

```{r}

# Diagramas de caja
par(mfrow = c(1, 2))
box_MP <- boxplot(playerstats$MP,main="MP outliers")
box_G <- boxplot(playerstats$G,main="G outliers")

# Valores más bajos dentro de la caja, a partir de donde hay outliers inferiores
box_MP$stats[2]
box_G$stats[2]

# Eliminación de registros considerados como outliers
playerstats <- playerstats[playerstats$MP > box_MP$stats[2],]
playerstats <- playerstats[playerstats$G > box_G$stats[2],]

```

# Análisis de los datos
## Selección de los grupos de datos que se quieren analizar/comparar

## Comprobación de la normalidad y homogeneidad de la varianza
```{r}

pearson.test(playerstats$PER)
lillie.test(playerstats$PER)
cvm.test(playerstats$PER)
ad.test(playerstats$PER)

plot(density(playerstats$PER), lwd=3, col='blue',
     xlim=c(0, 40), main='', las=1,
     xlab='Peso (kg)', ylab='Densidad')

qqnorm(playerstats$PER, main=bquote(~ n == .(playerstats$PER)))
  qqline(playerstats$PER)  # Para agregar la linea de referencia
```

## Aplicación de pruebas estadísticas para comparar los grupos de datos
### Regresión lineal, qué variables influyen más?
Debido a que el PER se calcula a partir de las variables de los volúmenes de tiro, se puede crear un modelo de predicción para predecir esta variable.

### Contraste de hipótesis
Influye la edad en el rendimiento? Se ve reflejado en el PER?

### Contraste de hipótesis (?)
Los jugadores de la posicion CENTER tienen un mejor PER?

# Resolución del problema

